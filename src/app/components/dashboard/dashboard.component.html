<div class="dashboard-container">
  <div class="dashboard-title">交通儀表板</div>
  <!-- 頂部狀態列 -->
  <div class="status-bar">
    <div class="status-item">
      <i class="fas fa-calendar-alt"></i>
      <div class="time-info">
        <div class="time-label">事故發生時間</div>
        <div class="time-value">2025-03-17 12:06:00</div>
      </div>
    </div>
    <div class="status-item">
      <i class="fas fa-clock"></i>
      <div class="time-info">
        <div class="time-label">報告產生時間</div>
        <div class="time-value">2025-03-17 12:11:00</div>
      </div>
    </div>
    <div class="status-item">
      <i class="fas fa-map-marker-alt"></i>
      <span>五權路交台灣大道二段事故（24.147735, 120.673648）</span>
    </div>
    <div class="status-item severity-display">
      <div class="severity-label">事故等級</div>
      <div class="severity-value" [ngClass]="'level-' + currentIncident?.severityLevel">
        <ng-container [ngSwitch]="currentIncident?.severityLevel">
          <ng-container *ngSwitchCase="1">
            <i class="fas fa-exclamation"></i>
            <span>輕微事故</span>
          </ng-container>
          <ng-container *ngSwitchCase="2">
            <i class="fas fa-exclamation"></i>
            <i class="fas fa-exclamation"></i>
            <span>重大事故</span>
          </ng-container>
          <ng-container *ngSwitchCase="3">
            <i class="fas fa-exclamation"></i>
            <i class="fas fa-exclamation"></i>
            <i class="fas fa-exclamation"></i>
            <span>致命事故</span>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- 主要內容區域 -->
  <div class="main-content">
    <!-- 狀態面板列 -->
    <div class="status-panels">
      <div class="status-panel">
        <div class="panel-header">
          <div class="panel-title">疑似傷亡人數</div>
          <div class="data-source-switch">
            <input type="checkbox" id="dataSourceToggle">
            <label class="slider" for="dataSourceToggle"></label>
            <div class="labels" data-on="已驗證" data-off="民眾通報(未驗證)"></div>
          </div>
        </div>
        <div class="panel-content">
          <div class="casualty-item">
            <span class="label">受傷</span>
            <span class="value">8</span>
            <span class="unit">人</span>
          </div>
          <div class="casualty-item">
            <span class="label">死亡</span>
            <span class="value">1</span>
            <span class="unit">人</span>
          </div>
        </div>
      </div>

      <div class="status-panel">
        <div class="panel-title">通報時間</div>
        <div class="panel-content">
          <span class="value">12:08</span>
        </div>
      </div>

      <div class="status-panel">
        <div class="panel-title">目前車速</div>
        <div class="panel-content">
          <span class="value">41</span>
          <span class="unit">km/h</span>
        </div>
      </div>

      <div class="status-panel highlight">
        <div class="panel-title">預計緩解時間</div>
        <div class="panel-content">
          <span class="value">50</span>
          <span class="unit">分鐘後</span>
        </div>
      </div>
    </div>

    <!-- 內容區域 -->
    <div class="content-area">
      <!-- 左側面板 -->
      <div class="left-panel">
        <!-- 事故周圍監視器區塊 -->
        <div class="nearby-cctv-section">
          <h3 class="main-title">事故周圍監視器</h3>
          <div class="cctv-container">
            <div class="cctv-grid">
              <div class="cctv-item">
                <img src="https://tcnvr3.taichung.gov.tw/39ad6688" alt="CCTV 1">
                <span class="cctv-label">CCTV 1</span>
              </div>
              <div class="cctv-item">
                <img src="https://tcnvr6.taichung.gov.tw/16883ac1" alt="CCTV 2">
                <span class="cctv-label">CCTV 2</span>
              </div>
              <div class="cctv-item">
                <img src="https://tcnvr3.taichung.gov.tw/584f2157" alt="CCTV 3">
                <span class="cctv-label">CCTV 3</span>
              </div>
              <div class="cctv-item">
                <img src="https://tcnvr6.taichung.gov.tw/5215b60d" alt="CCTV 4">
                <span class="cctv-label">CCTV 4</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 中央區域 -->
      <div class="center-panel">
        <!-- 影響範圍區塊 -->
        <div class="impact-area-section">
          <h3 class="main-title">影響範圍</h3>
          <div class="map-container">
            <app-map 
              [incidentLocation]="[24.147735, 120.673648]"
              [affectedArea]="[
                [24.1497109, 120.6741451],
                [24.1475278, 120.6719457],
                [24.1460005, 120.6738661],
                [24.1467544, 120.6746171],
                [24.1462747, 120.6750892],
                [24.1477138, 120.6765483],
                [24.1497109, 120.6741451]
              ]"
              [roadInfo]="{
                '五權路': {
                  coordinates: [
                    [24.1490225, 120.6749382],
                    [24.1468687, 120.6727173]
                  ],
                  speed: {
                    '即時車速': 38,
                    '10分鐘前': 60,
                    '20分鐘前': 28,
                    '30分鐘前': 72
                  }
                },
                '台灣大道二段往台中港方向': {
                  coordinates: [
                    [24.1467544, 120.6746171],
                    [24.1483763, 120.672787]
                  ],
                  speed: {
                    '即時車速': 65,
                    '10分鐘前': 35,
                    '20分鐘前': 70,
                    '30分鐘前': 42
                  }
                },
                '台灣大道二段往台中火車站方向': {
                  coordinates: [
                    [24.1482833, 120.6726824],
                    [24.1466925, 120.6745493]
                  ],
                  speed: {
                    '即時車速': 22,
                    '10分鐘前': 48,
                    '20分鐘前': 55,
                    '30分鐘前': 68
                  }
                }
              }"
            ></app-map>
          </div>
        </div>

        <!-- 交通流量圖表 -->
        <div class="traffic-flow-section">
          <h3>主要幹道近3小時車速</h3>
          <div class="chart-container">
            <app-traffic-flow [data]="{
              '五權路': [15, 18, 22, 25, 28, 30, 32, 35, 38, 40, 42, 45],
              '台灣大道二段往台中港方向': [45, 48, 50, 52, 55, 58, 60, 62, 65, 68, 70, 72],
              '台灣大道二段往台中火車站方向': [65, 68, 70, 72, 75, 78, 80, 82, 85, 88, 90, 92]
            }"></app-traffic-flow>
          </div>
        </div>
      </div>

      <!-- 右側面板 -->
      <div class="right-panel">
        <!-- 事故處理進度 -->
        <div class="progress-section">
          <div class="section-header">
            <h3>事故處理進度</h3>
            <div class="last-update">
              <i class="fas fa-clock"></i>
              最新更新時間(第一線回報): {{ lastUpdateTime | date:'yyyy-MM-dd HH:mm' }}
            </div>
          </div>
          <div class="order-status">
            <div class="order-status-timeline">
              <div class="order-status-timeline-completion c2"></div>
            </div>
            <div class="image-order-status active">
              <div class="icon">
                <i class="fas fa-bullhorn"></i>
              </div>
              <span class="status">民眾通報</span>
            </div>
            <div class="image-order-status active">
              <div class="icon">
                <i class="fas fa-user-shield"></i>
              </div>
              <span class="status">應變人員到場</span>
            </div>
            <div class="image-order-status active">
              <div class="icon">
                <i class="fas fa-tools"></i>
              </div>
              <span class="status">現場處理</span>
            </div>
            <div class="image-order-status">
              <div class="icon">
                <i class="fas fa-ambulance"></i>
              </div>
              <span class="status">傷者送醫</span>
            </div>
            <div class="image-order-status">
              <div class="icon">
                <i class="fas fa-check-circle"></i>
              </div>
              <span class="status">處理完畢</span>
            </div>
            <div class="image-order-status">
              <div class="icon">
                <i class="fas fa-road"></i>
              </div>
              <span class="status">交通恢復</span>
            </div>
          </div>
        </div>

        <!-- 應變措施建議 -->
        <div class="suggestions-section">
          <h3>
            <i class="fas fa-lightbulb"></i>
            應變措施建議
          </h3>
          <div class="suggestion-cards">
            <div class="suggestion-card">
              <h4>
                <i class="fas fa-route"></i>
                用路人改道建議
              </h4>
              <p>建議改道行駛忠明南路或向上路，避開五權路與台灣大道二段交會處的壅塞區域，以減少行車延誤。</p>
            </div>
            <div class="suggestion-card">
              <h4>
                <i class="fas fa-sign"></i>
                CMS設定建議
              </h4>
              <p>建議於台灣大道二段、忠明南路CMS，顯示「五權路與台灣大道二段事故，預計 45 分鐘恢復，請提前改道忠明南路或向上路。」</p>
            </div>
            <div class="suggestion-card news">
              <h4>
                <i class="fas fa-newspaper"></i>
                新聞輿情彙整
              </h4>
              <div class="news-content">
                <h5>事故嚴重性與社會關注</h5>
                <p>多家媒體大篇幅報導該事故，強調這起車禍造成 1 人死亡、8 人受傷，成為當日台中最嚴重的交通事故，引起社會廣泛關注。</p>
                <h5>道路安全與高風險因素</h5>
                <p>新聞提及，五權路與台灣大道交會口為高車流區域，該處轉向車輛與直行車輛匯流頻繁，過去亦曾發生類似碰撞事故，是否有號誌配置或標線問題，值得檢討。</p>
                <h5>政府應對與運輸安全檢討</h5>
                <p>警方已啟動調查，釐清事故主因，市府交通局則表示將檢討該路口是否需增設交通導引標誌，並考慮調整車道設計，以減少事故風險。</p>
                <h5>輿論反應與政策討論</h5>
                <p>社群媒體與論壇上，不少網友對該路口的行車安全表示擔憂，並呼籲政府應加強區域內速限管理與號誌優化，防止類似悲劇再度發生。</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 